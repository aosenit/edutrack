{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport { JwtHelperService } from '@auth0/angular-jwt';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"src/services/classes/notifications/notifications.service\";\nimport * as i4 from \"src/services/data/auth/auth.service\";\nimport * as i5 from \"src/services/data/school/school.service\";\nimport * as i6 from \"@angular/common\";\nfunction TeacherLoginComponent_img_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"img\", 24);\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵpropertyInterpolate1(\"src\", \"data:image/png;base64,\", ctx_r0.matchedSchoolDetail.logo, \"\", i0.ɵɵsanitizeUrl);\n  }\n}\nfunction TeacherLoginComponent_div_22_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 27);\n    i0.ɵɵtext(1, \"Username is required\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction TeacherLoginComponent_div_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 25);\n    i0.ɵɵtemplate(1, TeacherLoginComponent_div_22_div_1_Template, 2, 0, \"div\", 26);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.teacherLoginForm.controls.username.errors.required);\n  }\n}\nfunction TeacherLoginComponent_div_29_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 27);\n    i0.ɵɵtext(1, \"Password is required\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction TeacherLoginComponent_div_29_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 27);\n    i0.ɵɵtext(1, \"Password must be at least 5 characters\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction TeacherLoginComponent_div_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 25);\n    i0.ɵɵtemplate(1, TeacherLoginComponent_div_29_div_1_Template, 2, 0, \"div\", 26)(2, TeacherLoginComponent_div_29_div_2_Template, 2, 0, \"div\", 26);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.teacherLoginForm.controls.password.errors.required);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.teacherLoginForm.controls.password.errors.minlength);\n  }\n}\nexport let TeacherLoginComponent = /*#__PURE__*/(() => {\n  class TeacherLoginComponent {\n    constructor(fb, router, notifyService, authService, schoolService) {\n      this.fb = fb;\n      this.router = router;\n      this.notifyService = notifyService;\n      this.authService = authService;\n      this.schoolService = schoolService;\n      this.submitted = false;\n    }\n    ngOnInit() {\n      this.subdomain = localStorage.getItem('sub-domain');\n      this.detectSchoolDomain();\n      this.teacherLoginForm = this.fb.group({\n        username: ['', Validators.required],\n        password: ['', [Validators.minLength(5), Validators.required]]\n      });\n    }\n    detectSchoolDomain() {\n      this.schoolService.getSchoolDomainName(this.subdomain).subscribe(data => {\n        if (data.hasErrors === false) {\n          // // (data.payload);\n          this.matchedSchoolDetail = data.payload;\n        } else {\n          this.notifyService.publishMessages(data.errors, 'danger', 1);\n          setTimeout(() => {\n            // this.router.navigateByUrl('/');\n          }, 2000);\n        }\n      }, error => {\n        this.notifyService.publishMessages('School doesnt exist', 'danger', 1);\n      });\n    }\n    submit() {\n      if (this.teacherLoginForm.invalid) {\n        this.submitted = true;\n        return;\n      } else {\n        this.authService.loginAdmin(this.teacherLoginForm.value).subscribe(data => {\n          if (data) {\n            localStorage.setItem('access_token', data.access_token);\n            this.notifyService.publishMessages('Login successful', 'success', 1);\n            const helper = new JwtHelperService();\n            this.loggedInUser = helper.decodeToken(localStorage.getItem('access_token'));\n            if (this.loggedInUser.UserType === 'TeachingStaff') {\n              this.router.navigateByUrl('/teacher');\n            } else {\n              localStorage.removeItem('access_token');\n              this.notifyService.publishMessages('Invalid details, please select the right login type', 'danger', 1);\n              this.router.navigateByUrl('/');\n            }\n          }\n        }, error => {\n          this.notifyService.publishMessages(error.message, 'danger', 1);\n        });\n        // location.reload();\n      }\n    }\n    static #_ = (() => this.ɵfac = function TeacherLoginComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || TeacherLoginComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.NotificationsService), i0.ɵɵdirectiveInject(i4.AuthService), i0.ɵɵdirectiveInject(i5.SchoolService));\n    })();\n    static #_2 = (() => this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: TeacherLoginComponent,\n      selectors: [[\"app-teacher-login\"]],\n      decls: 42,\n      vars: 5,\n      consts: [[1, \"\"], [1, \"login\"], [\"alt\", \"schools log\", \"class\", \"mr-3 school-logo\", \"id\", \"\", 3, \"src\", 4, \"ngIf\"], [1, \"container\"], [1, \"row\"], [1, \"col-lg-5\", \"m-auto\"], [1, \"whitediv\", \"d-flex\", \"justify-content-center\", \"align-items-center\", \"p-lg-5\", \"p-3\", \"mt-lg-5\"], [1, \"col-lg-12\", \"d-flex\", \"justify-content-center\", \"mb-5\"], [1, \"fs-30\", \"mb-2\", \"text-center\"], [1, \"fs-30\", \"text-center\"], [1, \"col-lg-12\"], [3, \"ngSubmit\", \"formGroup\"], [1, \"col-lg-12\", \"mb-3\"], [\"for\", \"\", 1, \"fs-16\", \"ff-n\", \"fw-6\", \"fc-dark\", \"m-0\"], [1, \"fs-12\", \"ff-n\", \"fc-dark\", \"mb-3\"], [\"type\", \"text\", \"formControlName\", \"username\", 1, \"form-control\", \"reg-form\"], [\"class\", \"error\", 4, \"ngIf\"], [\"type\", \"password\", \"formControlName\", \"password\", 1, \"form-control\", \"reg-form\", \"mb-2\"], [1, \"text-right\"], [\"routerLink\", \"/forgotpassword\", 1, \"fc-lblue\", \"fs-14\", \"fw-6\", \"ff-n\"], [1, \"btn\", \"btn-blue\", \"w-100\"], [1, \"foot\", \"bg-dark\", \"py-3\"], [1, \"fc-grey\", \"ff-a\", \"fs-12\", \"m-0\", \"text-center\"], [1, \"fw-6\", \"ls-7\"], [\"alt\", \"schools log\", \"id\", \"\", 1, \"mr-3\", \"school-logo\", 3, \"src\"], [1, \"error\"], [\"class\", \"text-danger\", 4, \"ngIf\"], [1, \"text-danger\"]],\n      template: function TeacherLoginComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1);\n          i0.ɵɵtemplate(2, TeacherLoginComponent_img_2_Template, 1, 2, \"img\", 2);\n          i0.ɵɵelementStart(3, \"div\", 3)(4, \"div\", 4)(5, \"div\", 5)(6, \"div\", 6)(7, \"div\", 4)(8, \"div\", 7)(9, \"div\")(10, \"h6\", 8);\n          i0.ɵɵtext(11);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(12, \"p\", 9);\n          i0.ɵɵtext(13, \"Teacher Login\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(14, \"div\", 10)(15, \"form\", 11);\n          i0.ɵɵlistener(\"ngSubmit\", function TeacherLoginComponent_Template_form_ngSubmit_15_listener() {\n            return ctx.submit();\n          });\n          i0.ɵɵelementStart(16, \"div\", 12)(17, \"p\", 13);\n          i0.ɵɵtext(18, \"Username \");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(19, \"small\", 14);\n          i0.ɵɵtext(20, \"Please enter your username in the box below.\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(21, \"input\", 15);\n          i0.ɵɵtemplate(22, TeacherLoginComponent_div_22_Template, 2, 1, \"div\", 16);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(23, \"div\", 12)(24, \"p\", 13);\n          i0.ɵɵtext(25, \"Password\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(26, \"small\", 14);\n          i0.ɵɵtext(27, \"Please enter your password in the box below.\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(28, \"input\", 17);\n          i0.ɵɵtemplate(29, TeacherLoginComponent_div_29_Template, 3, 2, \"div\", 16);\n          i0.ɵɵelementStart(30, \"p\", 18)(31, \"a\", 19);\n          i0.ɵɵtext(32, \"Forgot Password?\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(33, \"div\", 12)(34, \"button\", 20);\n          i0.ɵɵtext(35, \" Login \");\n          i0.ɵɵelementEnd()()()()()()()()()();\n          i0.ɵɵelementStart(36, \"div\", 21)(37, \"p\", 22);\n          i0.ɵɵtext(38, \"\\u00A9 2020. \");\n          i0.ɵɵelementStart(39, \"span\", 23);\n          i0.ɵɵtext(40, \"SchoolTrack\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtext(41, \" - All rights reserved \");\n          i0.ɵɵelementEnd()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngIf\", ctx.matchedSchoolDetail);\n          i0.ɵɵadvance(9);\n          i0.ɵɵtextInterpolate1(\"Welcome to \", ctx.matchedSchoolDetail == null ? null : ctx.matchedSchoolDetail.schoolName, \"\");\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"formGroup\", ctx.teacherLoginForm);\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"ngIf\", ctx.submitted && ctx.teacherLoginForm.controls.username.errors);\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"ngIf\", ctx.submitted && ctx.teacherLoginForm.controls.password.errors);\n        }\n      },\n      dependencies: [i6.NgIf, i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName, i2.RouterLink],\n      styles: [\".login[_ngcontent-%COMP%]{background:url(kids.png);background-size:cover;min-height:93vh}.whitediv[_ngcontent-%COMP%]{margin-top:6rem!important}.btn-blue[_ngcontent-%COMP%]{background:#155b75;height:48px;font-family:Nunito;font-style:normal;font-weight:600;font-size:16px;line-height:22px;color:#fff;border-radius:5px}.foot[_ngcontent-%COMP%]{height:7vh}.school-logo[_ngcontent-%COMP%]{position:absolute;top:25px;left:20px;max-width:150px;max-height:60px}\"]\n    }))();\n  }\n  return TeacherLoginComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}