{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"src/services/data/staff/staff.service\";\nimport * as i3 from \"src/services/data/teacher/teacher.service\";\nimport * as i4 from \"src/services/classes/notifications/notifications.service\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"../employee.component\";\nimport * as i7 from \"@angular/common\";\nfunction MediaComponent_label_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"label\", 15);\n    i0.ɵɵtext(1, \" Upload File \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction MediaComponent_ng_template_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"label\", 15);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.profilephotoname, \" \");\n  }\n}\nfunction MediaComponent_label_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"label\", 15);\n    i0.ɵɵtext(1, \" Upload File \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction MediaComponent_ng_template_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"label\", 15);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.signaturename, \" \");\n  }\n}\nexport let MediaComponent = /*#__PURE__*/(() => {\n  class MediaComponent {\n    constructor(fb, staffService, teacherService, notifyService, router, home, route) {\n      this.fb = fb;\n      this.staffService = staffService;\n      this.teacherService = teacherService;\n      this.notifyService = notifyService;\n      this.router = router;\n      this.home = home;\n      this.route = route;\n      this.sendChildName = new EventEmitter();\n      this.profilephotoname = null;\n      this.signaturename = null;\n      this.signature = [];\n      this.photo = [];\n      this.DocumentTypes = [];\n    }\n    ngOnInit() {\n      this.sendChildName.emit('Images');\n      this.mediaForm = this.fb.group({\n        profile: [null],\n        signature: [null]\n      });\n      this.id = this.route.snapshot.params.id;\n      // console.log('page id', this.id);\n      this.route.params.subscribe(param => {\n        if (!param.id) {\n          this.createMediaForm();\n        } else {\n          this.updateMediaForm();\n        }\n      });\n    }\n    createMediaForm() {\n      this.mediaForm = this.fb.group({\n        profile: [null],\n        signature: [null]\n      });\n    }\n    updateMediaForm() {\n      this.mediaForm = this.fb.group({\n        profile: [null],\n        signature: [null]\n      });\n    }\n    createEmployee() {\n      const profile = JSON.parse(sessionStorage.getItem('employee-personal-data'));\n      const details = JSON.parse(sessionStorage.getItem('Employee-Data'));\n      const contactperson = JSON.parse(sessionStorage.getItem('employee-contact-details'));\n      const education = JSON.parse(sessionStorage.getItem('employee-education'));\n      const nextKin = JSON.parse(sessionStorage.getItem('employee-next-kin'));\n      const experience = JSON.parse(sessionStorage.getItem('employee-experience'));\n      const finalstep = this.mediaForm.value;\n      // console.log(finalstep);\n      const result = {\n        ...profile,\n        ...details,\n        ...contactperson,\n        ...education,\n        ...nextKin,\n        ...experience,\n        ...finalstep,\n        DocumentTypes: this.DocumentTypes\n      };\n      // const {StaffType} = details;\n      // console.log(result.StaffType);\n      // creating employer and teacher\n      if (result.StaffType === '1') {\n        this.teacherService.addTeacher(result).subscribe(data => {\n          // console.log('employee added', data);\n          if (data.hasErrors === false) {\n            this.notifyService.publishMessages(data.description, 'info', 1);\n            sessionStorage.removeItem('employee-personal-data');\n            sessionStorage.removeItem('Employee-Data');\n            sessionStorage.removeItem('employee-contact-details');\n            sessionStorage.removeItem('employee-education');\n            sessionStorage.removeItem('employee-next-kin');\n            sessionStorage.removeItem('employee-experience');\n            this.router.navigateByUrl('/school/teacher');\n          } else {\n            this.notifyService.publishMessages(data.errors, 'danger', 1);\n          }\n        }, error => {\n          this.notifyService.publishMessages(error.errors, 'danger', 1);\n        });\n      } else {\n        // console.log('all employee data', result);\n        this.staffService.addStaff(result).subscribe(data => {\n          // console.log('employee added', data);\n          if (data.hasErrors === false) {\n            this.notifyService.publishMessages(data.description, 'info', 1);\n            sessionStorage.removeItem('employee-personal-data');\n            sessionStorage.removeItem('Employee-Data');\n            sessionStorage.removeItem('employee-contact-details');\n            sessionStorage.removeItem('employee-education');\n            sessionStorage.removeItem('employee-next-kin');\n            sessionStorage.removeItem('employee-experience');\n            this.router.navigateByUrl('/school/employees');\n          } else {\n            this.notifyService.publishMessages(data.errors, 'danger', 1);\n          }\n        }, error => {\n          this.notifyService.publishMessages(error.errors, 'danger', 1);\n        });\n      }\n    }\n    updateEmployee() {\n      const profile = JSON.parse(sessionStorage.getItem('employee-personal-data'));\n      const details = JSON.parse(sessionStorage.getItem('Employee-Data'));\n      const contactperson = JSON.parse(sessionStorage.getItem('employee-contact-details'));\n      const education = JSON.parse(sessionStorage.getItem('employee-education'));\n      const nextKin = JSON.parse(sessionStorage.getItem('employee-next-kin'));\n      const experience = JSON.parse(sessionStorage.getItem('employee-experience'));\n      const finalstep = this.mediaForm.value;\n      // console.log(finalstep);\n      const result = {\n        ...profile,\n        ...details,\n        ...contactperson,\n        ...education,\n        ...nextKin,\n        ...experience,\n        ...finalstep,\n        DocumentTypes: this.DocumentTypes\n      };\n      // const {StaffType} = details;\n      // console.log(result.StaffType);\n      // creating employer and teacher\n      if (result.StaffType == '1') {\n        this.teacherService.updateTeacher(this.id, result).subscribe(data => {\n          // console.log('updating teacher added', data);\n          if (data.hasErrors === false) {\n            this.notifyService.publishMessages(data.description, 'info', 1);\n            sessionStorage.removeItem('employee-personal-data');\n            sessionStorage.removeItem('Employee-Data');\n            sessionStorage.removeItem('employee-contact-details');\n            sessionStorage.removeItem('employee-education');\n            sessionStorage.removeItem('employee-next-kin');\n            sessionStorage.removeItem('employee-experience');\n            this.router.navigateByUrl('/school/teacher');\n          } else {\n            this.notifyService.publishMessages(data.errors, 'danger', 1);\n          }\n        }, error => {\n          this.notifyService.publishMessages(error.errors, 'danger', 1);\n        });\n      } else if (result.StaffType == '2') {\n        // console.log('all employee data', result);\n        this.staffService.updateStaff(this.id, result).subscribe(data => {\n          // console.log('updating added', data);\n          if (data.hasErrors === false) {\n            this.notifyService.publishMessages(data.description, 'info', 1);\n            sessionStorage.removeItem('employee-personal-data');\n            sessionStorage.removeItem('Employee-Data');\n            sessionStorage.removeItem('employee-contact-details');\n            sessionStorage.removeItem('employee-education');\n            sessionStorage.removeItem('employee-next-kin');\n            sessionStorage.removeItem('employee-experience');\n            this.router.navigateByUrl('/school/employees');\n          } else {\n            this.notifyService.publishMessages(data.errors, 'danger', 1);\n          }\n        }, error => {\n          this.notifyService.publishMessages(error.errors, 'danger', 1);\n        });\n      }\n    }\n    handlePhotoUpload(event) {\n      if (event.target.files.length > 0) {\n        const file = event.target.files[0];\n        // console.log('file', file);\n        this.profilephotoname = file.name;\n        this.DocumentTypes[0] = 2;\n        this.mediaForm.get('profile').setValue(file);\n        // this.iconname = this.icon.name;\n        const size = event.target.files[0].size;\n        if (size >= 1048576) {\n          this.notifyService.publishMessages('File size too large', 'danger', 1);\n          this.DocumentTypes[0] = 0;\n        } else {\n          this.DocumentTypes[0] = 2;\n          // console.log(this.DocumentTypes);\n        }\n      }\n    }\n    handleSignatureUpload(event) {\n      if (event.target.files.length > 0) {\n        const file = event.target.files[0];\n        // console.log('file', file);\n        this.signaturename = file.name;\n        this.DocumentTypes[1] = 8;\n        this.mediaForm.get('signature').setValue(file);\n        const size = event.target.files[0].size;\n        if (size >= 1048576) {\n          this.notifyService.publishMessages('File size too large', 'danger', 1);\n          this.DocumentTypes[1] = 0;\n        } else {\n          this.DocumentTypes[1] = 8;\n          // console.log(this.DocumentTypes);\n        }\n        // this.iconname = this.icon.name;\n      }\n    }\n    prevStep() {\n      this.home.stepper(6);\n      // this.currentStep = document.getElementById('step-' + `${3 + 1}`);\n      // this.currentStep.classList.remove('active');\n    }\n    static #_ = (() => this.ɵfac = function MediaComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || MediaComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.StaffService), i0.ɵɵdirectiveInject(i3.TeacherService), i0.ɵɵdirectiveInject(i4.NotificationsService), i0.ɵɵdirectiveInject(i5.Router), i0.ɵɵdirectiveInject(i6.EmployeeComponent), i0.ɵɵdirectiveInject(i5.ActivatedRoute));\n    })();\n    static #_2 = (() => this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: MediaComponent,\n      selectors: [[\"app-media\"]],\n      outputs: {\n        sendChildName: \"sendChildName\"\n      },\n      decls: 30,\n      vars: 7,\n      consts: [[\"profile\", \"\"], [\"icon\", \"\"], [1, \"Media\"], [3, \"formGroup\"], [1, \"form-row\", \"mb-5\"], [1, \"\"], [\"for\", \"icon\", 1, \"fw-6\"], [1, \"custom-file\", \"mb-3\"], [\"type\", \"file\", \"accept\", \"image/png, image/jpeg\", \"id\", \"customFile\", \"name\", \"profilephotoname\", 1, \"custom-file-input\", 3, \"change\"], [\"class\", \"custom-file-label\", \"for\", \"customFile\", 4, \"ngIf\", \"ngIfElse\"], [1, \"text-danger\"], [\"type\", \"file\", \"accept\", \"image/png, image/jpeg\", \"id\", \"customFile\", \"name\", \"signaturename\", 1, \"custom-file-input\", 3, \"change\"], [1, \"d-flex\", \"justify-content-center\", \"mt-5\", \"mb-5\"], [1, \"btn\", \"btn-outline-orange\", \"mx-2\", \"mx-lg-3\", \"px-5\", \"mb-4\", \"mt-3\", 3, \"click\"], [1, \"btn\", \"btn-orange-two\", \"mx-2\", \"mx-lg-3\", \"px-5\", \"mb-4\", \"mt-3\", 3, \"click\", \"hidden\"], [\"for\", \"customFile\", 1, \"custom-file-label\"]],\n      template: function MediaComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          const _r1 = i0.ɵɵgetCurrentView();\n          i0.ɵɵelementStart(0, \"div\", 2)(1, \"form\", 3)(2, \"div\", 4)(3, \"div\", 5)(4, \"label\", 6);\n          i0.ɵɵtext(5, \"Photo\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(6, \"div\", 7)(7, \"input\", 8);\n          i0.ɵɵlistener(\"change\", function MediaComponent_Template_input_change_7_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.handlePhotoUpload($event));\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(8, MediaComponent_label_8_Template, 2, 0, \"label\", 9)(9, MediaComponent_ng_template_9_Template, 2, 1, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n          i0.ɵɵelementStart(11, \"small\", 10);\n          i0.ɵɵtext(12, \"Upload file not more than 1mb\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(13, \"div\", 5)(14, \"label\", 6);\n          i0.ɵɵtext(15, \"Signature\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(16, \"div\", 7)(17, \"input\", 11);\n          i0.ɵɵlistener(\"change\", function MediaComponent_Template_input_change_17_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.handleSignatureUpload($event));\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(18, MediaComponent_label_18_Template, 2, 0, \"label\", 9)(19, MediaComponent_ng_template_19_Template, 2, 1, \"ng-template\", null, 1, i0.ɵɵtemplateRefExtractor);\n          i0.ɵɵelementStart(21, \"small\", 10);\n          i0.ɵɵtext(22, \"Upload file not more than 1mb\");\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(23, \"div\", 12)(24, \"button\", 13);\n          i0.ɵɵlistener(\"click\", function MediaComponent_Template_button_click_24_listener() {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.prevStep());\n          });\n          i0.ɵɵtext(25, \" Back \");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(26, \"button\", 14);\n          i0.ɵɵlistener(\"click\", function MediaComponent_Template_button_click_26_listener() {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.createEmployee());\n          });\n          i0.ɵɵtext(27, \" Create \");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(28, \"button\", 14);\n          i0.ɵɵlistener(\"click\", function MediaComponent_Template_button_click_28_listener() {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.updateEmployee());\n          });\n          i0.ɵɵtext(29, \" Update \");\n          i0.ɵɵelementEnd()()()();\n        }\n        if (rf & 2) {\n          const profile_r3 = i0.ɵɵreference(10);\n          const icon_r4 = i0.ɵɵreference(20);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"formGroup\", ctx.mediaForm);\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"ngIf\", ctx.profilephotoname === null)(\"ngIfElse\", profile_r3);\n          i0.ɵɵadvance(10);\n          i0.ɵɵproperty(\"ngIf\", ctx.signaturename === null)(\"ngIfElse\", icon_r4);\n          i0.ɵɵadvance(8);\n          i0.ɵɵproperty(\"hidden\", ctx.id);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"hidden\", !ctx.id);\n        }\n      },\n      dependencies: [i7.NgIf, i1.ɵNgNoValidate, i1.NgControlStatusGroup, i1.FormGroupDirective],\n      styles: [\".form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-gap:7rem}h6[_ngcontent-%COMP%]{font-weight:700;font-weight:600}form[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%], .custom-file-input[_ngcontent-%COMP%]{color:#000;font-size:16px;border:1px solid #D1D9DF}p[_ngcontent-%COMP%]{color:#000;font-size:14px}#customFile[_ngcontent-%COMP%]   .custom-file-control[_ngcontent-%COMP%]:lang(en):after{content:\\\"Select file...\\\"}.custom-file-label[_ngcontent-%COMP%]:after{position:absolute;top:5px;right:5px;bottom:0;z-index:3;display:block;padding:10px 15px;height:25px 25px;line-height:1.5;color:#355691;content:\\\"Upload\\\";background:#e5ebf5;border-radius:3px;border-left:inherit;display:flex;align-items:center;justify-content:center;height:26px}@media screen and (max-width: 820px){.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;grid-gap:2.5rem}}\"]\n    }))();\n  }\n  return MediaComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}