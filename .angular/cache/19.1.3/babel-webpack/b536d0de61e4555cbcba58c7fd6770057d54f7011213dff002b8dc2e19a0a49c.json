{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport * as moment from 'moment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"src/services/data/subscriptions/subscriptions.service\";\nimport * as i3 from \"src/services/classes/notifications/notifications.service\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"@angular/common\";\nexport let SubscriptionInvoiceArreasComponent = /*#__PURE__*/(() => {\n  class SubscriptionInvoiceArreasComponent {\n    constructor(fb, subscriptionServie, notifyService, router, route) {\n      this.fb = fb;\n      this.subscriptionServie = subscriptionServie;\n      this.notifyService = notifyService;\n      this.router = router;\n      this.route = route;\n    }\n    ngOnInit() {\n      this.schoolId = this.route.snapshot.params.id;\n      this.getNextInvoice();\n      this.initiateInvoiceForm();\n    }\n    initiateInvoiceForm() {\n      this.subscriptionInvoiceForm = this.fb.group({\n        endDate: ['', Validators.required],\n        price: ['', Validators.required],\n        studentCount: ['', Validators.required],\n        school: ['', Validators.required],\n        schoolId: ['']\n      });\n    }\n    getNextInvoice() {\n      this.subscriptionServie.getArrearSubscriptions(this.schoolId).subscribe(res => {\n        if (res.hasErrors === false) {\n          console.log(res.payload);\n          this.patchData(res.payload);\n        }\n      });\n    }\n    patchData(payload) {\n      this.subscriptionInvoiceForm.patchValue({\n        endDate: moment(payload.dueDate).format('YYYY-MM-DD'),\n        price: payload.amountPerStudent,\n        studentCount: payload.numberOfStudent,\n        school: payload.schoolName,\n        schoolId: payload.schoolId\n      });\n    }\n    createSubscriptionInvoice() {\n      const {\n        endDate,\n        price,\n        studentCount,\n        school,\n        schoolId\n      } = this.subscriptionInvoiceForm.value;\n      const result = {\n        dueDate: endDate,\n        amountPerStudent: price,\n        // tslint:disable-next-line:radix\n        numberOfStudent: parseInt(studentCount),\n        schoolId,\n        schoolName: school\n      };\n      console.log(result);\n      this.subscriptionServie.createArrearsSubscription(result).subscribe(res => {\n        if (res.hasErrors === false) {\n          console.log(res.payload);\n          this.notifyService.publishMessages(res.description, 'success', 1);\n          this.router.navigateByUrl('/admin/subscription');\n        } else {\n          this.notifyService.publishMessages(res.errors, 'success', 1);\n        }\n      });\n    }\n    back() {\n      window.history.back();\n    }\n    allowNumbersOnly(e) {\n      const ev = e || window.event;\n      const charcode = ev.which ? ev.which : ev.keycode;\n      if (charcode > 31 && (charcode < 48 || charcode > 57) && charcode !== 46) {\n        e.preventDefault();\n        return false;\n      }\n      return true;\n    }\n    static #_ = (() => this.ɵfac = function SubscriptionInvoiceArreasComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || SubscriptionInvoiceArreasComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.SubscriptionsService), i0.ɵɵdirectiveInject(i3.NotificationsService), i0.ɵɵdirectiveInject(i4.Router), i0.ɵɵdirectiveInject(i4.ActivatedRoute));\n    })();\n    static #_2 = (() => this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: SubscriptionInvoiceArreasComponent,\n      selectors: [[\"app-subscription-invoice-arreas\"]],\n      decls: 72,\n      vars: 9,\n      consts: [[\"school\", \"\"], [\"endDate\", \"\"], [\"amount\", \"\"], [\"student\", \"\"], [\"aria-label\", \"breadcrumb\"], [1, \"breadcrumb\"], [\"src\", \"assets/images/svg/breadcrumb.svg\", \"alt\", \"...\", 1, \"mr-3\"], [\"aria-current\", \"page\", 1, \"breadcrumb-item\", \"a1\", 3, \"click\"], [1, \"h-75\", \"bg-white\"], [1, \"row\"], [1, \"col-md-6\"], [1, \"pt-5\", 3, \"ngSubmit\", \"formGroup\"], [1, \"form-group\"], [\"for\", \"name\", 1, \"fw-6\"], [1, \"text-danger\"], [\"type\", \"text\", \"name\", \"\", \"id\", \"name\", \"formControlName\", \"school\", \"readonly\", \"\", 1, \"form-control\"], [\"for\", \"endDate\", 1, \"fw-6\"], [\"type\", \"date\", \"name\", \"\", \"id\", \"endDate\", \"formControlName\", \"endDate\", 1, \"form-control\"], [\"for\", \"amount\", 1, \"fw-6\"], [\"type\", \"text\", \"placeholder\", \"Enter amount\", \"id\", \"amount\", \"formControlName\", \"price\", 1, \"form-control\", 3, \"keypress\"], [\"for\", \"number\", 1, \"fw-6\"], [\"type\", \"text\", \"placeholder\", \"Enter Number\", \"id\", \"number\", \"formControlName\", \"studentCount\", 1, \"form-control\", 3, \"keypress\"], [1, \"mt-5\"], [1, \"btn\", \"btn-orange-two\", \"px-5\", \"mb-4\", \"mt-3\", 3, \"disabled\"], [1, \"col-md-6\", \"mt-5\", \"pr-5\"], [1, \"m-3\", \"invoice\", \"p-4\"], [1, \"d-flex\", \"mb-3\"], [1, \"fw-6\"]],\n      template: function SubscriptionInvoiceArreasComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          const _r1 = i0.ɵɵgetCurrentView();\n          i0.ɵɵelementStart(0, \"nav\", 4)(1, \"ol\", 5);\n          i0.ɵɵelement(2, \"img\", 6);\n          i0.ɵɵelementStart(3, \"li\", 7);\n          i0.ɵɵlistener(\"click\", function SubscriptionInvoiceArreasComponent_Template_li_click_3_listener() {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.back());\n          });\n          i0.ɵɵelementStart(4, \"a\");\n          i0.ɵɵtext(5, \"Back\");\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(6, \"div\", 8)(7, \"div\", 9)(8, \"div\", 10)(9, \"form\", 11);\n          i0.ɵɵlistener(\"ngSubmit\", function SubscriptionInvoiceArreasComponent_Template_form_ngSubmit_9_listener() {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.createSubscriptionInvoice());\n          });\n          i0.ɵɵelementStart(10, \"div\", 12)(11, \"label\", 13);\n          i0.ɵɵtext(12, \"School Name \");\n          i0.ɵɵelementStart(13, \"span\", 14);\n          i0.ɵɵtext(14, \"*\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelement(15, \"input\", 15, 0);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(17, \"div\", 12)(18, \"label\", 16);\n          i0.ɵɵtext(19, \"End Date \");\n          i0.ɵɵelementStart(20, \"span\", 14);\n          i0.ɵɵtext(21, \"*\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelement(22, \"input\", 17, 1);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(24, \"div\", 12)(25, \"label\", 18);\n          i0.ɵɵtext(26, \"Price Per User (N) \");\n          i0.ɵɵelementStart(27, \"span\", 14);\n          i0.ɵɵtext(28, \"*\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(29, \"input\", 19, 2);\n          i0.ɵɵlistener(\"keypress\", function SubscriptionInvoiceArreasComponent_Template_input_keypress_29_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.allowNumbersOnly($event));\n          });\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(31, \"div\", 12)(32, \"label\", 20);\n          i0.ɵɵtext(33, \"Expected Number of Students \");\n          i0.ɵɵelementStart(34, \"span\", 14);\n          i0.ɵɵtext(35, \"*\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(36, \"input\", 21, 3);\n          i0.ɵɵlistener(\"keypress\", function SubscriptionInvoiceArreasComponent_Template_input_keypress_36_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.allowNumbersOnly($event));\n          });\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(38, \"div\", 22)(39, \"button\", 23);\n          i0.ɵɵtext(40, \" Generate \");\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(41, \"div\", 24)(42, \"div\", 25)(43, \"div\", 9)(44, \"div\", 10)(45, \"div\", 26)(46, \"p\", 27);\n          i0.ɵɵtext(47, \" School Name \");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(48, \"div\", 26)(49, \"p\", 27);\n          i0.ɵɵtext(50, \" End Date \");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(51, \"div\", 26)(52, \"p\", 27);\n          i0.ɵɵtext(53, \" Price Per User \");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(54, \"div\", 26)(55, \"p\", 27);\n          i0.ɵɵtext(56, \" Expected Number of user \");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(57, \"div\", 10)(58, \"div\", 26)(59, \"p\");\n          i0.ɵɵtext(60);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(61, \"div\", 26)(62, \"p\");\n          i0.ɵɵtext(63);\n          i0.ɵɵpipe(64, \"date\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(65, \"div\", 26)(66, \"p\");\n          i0.ɵɵtext(67);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(68, \"div\", 26)(69, \"p\");\n          i0.ɵɵtext(70);\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelement(71, \"div\");\n          i0.ɵɵelementEnd()()()();\n        }\n        if (rf & 2) {\n          const school_r2 = i0.ɵɵreference(16);\n          const endDate_r3 = i0.ɵɵreference(23);\n          const amount_r4 = i0.ɵɵreference(30);\n          const student_r5 = i0.ɵɵreference(37);\n          i0.ɵɵadvance(9);\n          i0.ɵɵproperty(\"formGroup\", ctx.subscriptionInvoiceForm);\n          i0.ɵɵadvance(30);\n          i0.ɵɵproperty(\"disabled\", ctx.subscriptionInvoiceForm.invalid);\n          i0.ɵɵadvance(21);\n          i0.ɵɵtextInterpolate1(\" \", school_r2.value, \" \");\n          i0.ɵɵadvance(3);\n          i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(64, 6, endDate_r3.value, \"medium\"), \" \");\n          i0.ɵɵadvance(4);\n          i0.ɵɵtextInterpolate1(\" \", \"NGN\" + amount_r4.value, \" \");\n          i0.ɵɵadvance(3);\n          i0.ɵɵtextInterpolate1(\" \", student_r5.value, \" \");\n        }\n      },\n      dependencies: [i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName, i5.DatePipe],\n      styles: [\"form[_ngcontent-%COMP%]{padding:0 3rem}.breadcrumb[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;padding:.75rem 0;margin-bottom:1rem;list-style:none;background-color:transparent;border-radius:.25rem;cursor:pointer}a[_ngcontent-%COMP%]{color:#1b5bac;font-weight:400;cursor:pointer}.breadcrumb-item[_ngcontent-%COMP%] + .breadcrumb-item[_ngcontent-%COMP%]:before{display:inline-block;padding-right:.5rem;color:#1b5bac;content:\\\">\\\";font-size:10px;display:none}.invoice[_ngcontent-%COMP%]{background:#ebf0f5}\"]\n    }))();\n  }\n  return SubscriptionInvoiceArreasComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}